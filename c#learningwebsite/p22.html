<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Learning C# Programming</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body class="container mt-4">
    <h1>Exploring Entity Framework Core</h1>
    <p>Entity Framework Core (EF Core) helps you interact with databases using C#. This chapter covers basic operations like creating, reading, updating, and deleting records (CRUD). We'll also explore some advanced features.</p>

    <h2>Getting Started</h2>
    <p>Start by clearing out the <code>Program.cs</code> file and adding:</p>
    <pre><code>Console.WriteLine("***** More Fun with Entity Framework Core *****");</code></pre>

    <h2>Creating Records</h2>
    <p>To add records to the database:</p>
    <ol>
      <li>Create the record in code.</li>
      <li>Add it to the <code>DbSet</code>.</li>
      <li>Call <code>SaveChanges()</code>.</li>
    </ol>
    <pre><code>var context = new ApplicationDbContext();
var newMake = new Make { Name = "BMW" };
context.Makes.Add(newMake);
context.SaveChanges();</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Add a new car to the database.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Create a new Car object
Set properties (e.g., Color, MakeId, PetName)
Add the Car object to the Cars DbSet
Save changes to the database</code></pre>

    <h2>Reading Records</h2>
    <p>To read records, use LINQ queries.</p>
    <pre><code>var cars = context.Cars.ToList();
foreach (var car in cars)
{
    Console.WriteLine($"{car.PetName} is {car.Color}");
}</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Retrieve and display all cars with a specific color.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Query the Cars DbSet for cars with the specified color
Loop through the results
Print each car's details</code></pre>

    <h2>Updating Records</h2>
    <p>To update records:</p>
    <ol>
      <li>Retrieve the record.</li>
      <li>Modify its properties.</li>
      <li>Call <code>SaveChanges()</code>.</li>
    </ol>
    <pre><code>var car = context.Cars.First();
car.Color = "Green";
context.SaveChanges();</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Change the color of a specific car.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Retrieve the car by its ID
Change the car's color property
Save changes to the database</code></pre>

    <h2>Deleting Records</h2>
    <p>To delete records:</p>
    <ol>
      <li>Retrieve the record.</li>
      <li>Call <code>Remove()</code> on the <code>DbSet</code>.</li>
      <li>Call <code>SaveChanges()</code>.</li>
    </ol>
    <pre><code>var car = context.Cars.First();
context.Cars.Remove(car);
context.SaveChanges();</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Delete a car from the database.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Retrieve the car by its ID
Remove the car from the Cars DbSet
Save changes to the database</code></pre>

    <h2>Advanced Features</h2>

    <h3>Global Query Filters</h3>
    <p>Automatically filter out records based on a condition.</p>
    <pre><code>builder.HasQueryFilter(c => c.IsDrivable == true);</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Set up a global query filter to exclude non-drivable cars.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>In the model configuration, add a query filter for IsDrivable property</code></pre>

    <h3>Raw SQL Queries</h3>
    <p>Use raw SQL for complex queries.</p>
    <pre><code>var car = context.Cars.FromSqlRaw("SELECT * FROM Cars WHERE Id = 1").First();</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Write a raw SQL query to get cars of a specific make.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Write a SQL query to select cars with the specified MakeId
Execute the query using FromSqlRaw</code></pre>

    <h3>Projections</h3>
    <p>Project data into a different shape.</p>
    <pre><code>var carNames = context.Cars.Select(c => c.PetName).ToList();</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Create a list of car names.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Query the Cars DbSet
Select the PetName property
Convert the results to a list</code></pre>

    <h3>Handling Database-Generated Values</h3>
    <p>EF Core automatically handles values generated by the database, like IDs.</p>
    <pre><code>var car = new Car { Color = "Yellow", MakeId = 1, PetName = "Herbie" };
context.Cars.Add(car);
context.SaveChanges();</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Add a new car and check its generated ID.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Create a new Car object
Set properties (e.g., Color, MakeId, PetName)
Add the Car object to the Cars DbSet
Save changes to the database
Print the generated ID</code></pre>

    <h3>Concurrency Checking</h3>
    <p>Handle conflicts when multiple users try to update the same record.</p>
    <pre><code>try
{
    context.SaveChanges();
}
catch (DbUpdateConcurrencyException ex)
{
    // Handle concurrency exception
}</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Implement concurrency checking for car updates.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>Try to save changes
Catch DbUpdateConcurrencyException
Handle the exception (e.g., retry or notify the user)</code></pre>

    <h3>Temporal Tables</h3>
    <p>Track changes over time with temporal tables.</p>
    <pre><code>builder.ToTable(b => b.IsTemporal());</code></pre>

    <h3>Exercise</h3>
    <p><strong>Task:</strong> Set up a temporal table for the Cars entity.</p>
    <p><strong>Pseudocode:</strong></p>
    <pre><code>In the model configuration, enable temporal table support</code></pre>

    <footer class="mt-4">
      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
          <li class="page-item">
            <a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p21.html">Previous</a>
          </li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/index.html">1</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p2.html">2</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p3.html">3</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p4.html">4</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p5.html">5</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p6.html">6</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p7.html">7</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p8.html">8</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p9.html">9</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p10.html">10</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p11.html">11</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p12.html">12</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p13.html">13</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p14.html">14</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p15.html">15</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p16.html">16</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p17.html">17</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p18.html">18</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p19.html">19</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p20.html">20</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p21.html">21</a></li>
          <li class="page-item active" aria-current="page"><a class="page-link" href="#">22</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p23.html">23</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p24.html">24</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p25.html">25</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p26.html">26</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p27.html">27</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p28.html">28</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p29.html">29</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p30.html">30</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p31.html">31</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p32.html">32</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p33.html">33</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p34.html">34</a></li>
          <li class="page-item"><a class="page-link" href="file:///C:/Users/allan/Desktop/c%23learningwebsite/p23.html">Next</a></li>
              </ul>
          </nav>
        </footer>
    
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+o2e40pHs2b8pfp1HgpKFO4ZzR0J" crossorigin="anonymous"></script>
      </body>